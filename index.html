<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì™¸í–‰ì„±ì˜ ìˆœí–‰ê³¼ ì—­í–‰ ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a20 0%, #1a1a3a 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .subtitle {
            text-align: center;
            color: #aaa;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .views-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .view-box {
            background: rgba(20, 20, 50, 0.8);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(100, 100, 200, 0.3);
        }

        .view-title {
            text-align: center;
            font-size: 16px;
            margin-bottom: 10px;
            color: #88ccff;
        }

        canvas {
            display: block;
            margin: 0 auto;
            background: radial-gradient(ellipse at center, #0a0a1a 0%, #000005 100%);
            border-radius: 10px;
        }

        .sky-view-container {
            background: rgba(20, 20, 50, 0.8);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(100, 100, 200, 0.3);
            margin-bottom: 20px;
        }

        #skyCanvas {
            background: linear-gradient(180deg, #000010 0%, #000020 100%);
        }

        .controls {
            background: rgba(30, 30, 60, 0.9);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(100, 100, 200, 0.3);
        }

        .control-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-play {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .btn-pause {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: #333;
        }

        .btn-stop {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .slider-container {
            flex: 1;
            max-width: 600px;
            min-width: 300px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #ccc;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.5);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
            border: none;
        }

        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .info-box {
            background: rgba(50, 50, 80, 0.5);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .info-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 18px;
            font-weight: bold;
        }

        .prograde {
            color: #4CAF50;
        }

        .retrograde {
            color: #f44336;
        }

        .stationary {
            color: #ffc107;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .color-sun { background: #ffdd00; box-shadow: 0 0 10px #ffdd00; }
        .color-earth { background: #4a9eff; }
        .color-mars { background: #ff6b4a; }
        .color-orbit { background: rgba(255,255,255,0.3); }

        .explanation {
            background: rgba(40, 40, 70, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
            line-height: 1.8;
        }

        .explanation h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .explanation ul {
            margin-left: 20px;
        }

        .highlight-prograde { color: #4CAF50; font-weight: bold; }
        .highlight-retrograde { color: #f44336; font-weight: bold; }
        .highlight-opposition { color: #ffd700; font-weight: bold; }

        @media (max-width: 900px) {
            .views-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŒ ì™¸í–‰ì„±ì˜ ìˆœí–‰ê³¼ ì—­í–‰ ì‹œë®¬ë ˆì´ì…˜</h1>
        <p class="subtitle">Planetary Retrograde Motion Simulator - ì§€êµ¬ì—ì„œ ê´€ì¸¡í•œ ì™¸í–‰ì„±(í™”ì„±)ì˜ ê²‰ë³´ê¸° ìš´ë™</p>

        <div class="views-container">
            <div class="view-box">
                <h3 class="view-title">â˜€ï¸ íƒœì–‘ ì¤‘ì‹¬ ë·° (ì‹¤ì œ ê¶¤ë„)</h3>
                <canvas id="helioCanvas" width="400" height="400"></canvas>
            </div>
            <div class="view-box">
                <h3 class="view-title">ğŸŒ ì§€êµ¬ ì¤‘ì‹¬ ë·° (ê²‰ë³´ê¸° ìš´ë™)</h3>
                <canvas id="geoCanvas" width="400" height="400"></canvas>
            </div>
        </div>

        <div class="sky-view-container">
            <h3 class="view-title">ğŸŒ  ë°¤í•˜ëŠ˜ì—ì„œ ë³¸ í™”ì„±ì˜ ì´ë™ ê²½ë¡œ (ë³„ìë¦¬ ë°°ê²½)</h3>
            <canvas id="skyCanvas" width="850" height="300"></canvas>
        </div>

        <div class="controls">
            <div class="control-row">
                <button class="btn btn-play" id="playBtn">â–¶ ì¬ìƒ</button>
                <button class="btn btn-pause" id="pauseBtn">â¸ ì¼ì‹œì •ì§€</button>
                <button class="btn btn-stop" id="stopBtn">â¹ ì •ì§€</button>
            </div>

            <div class="control-row">
                <div class="slider-container">
                    <div class="slider-label">
                        <span>ì¶© (Opposition)</span>
                        <span id="sliderValue">0%</span>
                        <span>ë‹¤ìŒ ì¶©</span>
                    </div>
                    <input type="range" class="slider" id="timeSlider" min="0" max="100" value="0">
                </div>
            </div>

            <div class="info-panel">
                <div class="info-box">
                    <div class="info-label">í˜„ì¬ ìš´ë™ ìƒíƒœ</div>
                    <div class="info-value" id="motionStatus">ìˆœí–‰</div>
                </div>
                <div class="info-box">
                    <div class="info-label">íšŒí•©ì£¼ê¸° ì§„í–‰</div>
                    <div class="info-value" id="synodicProgress">0ì¼ / 780ì¼</div>
                </div>
                <div class="info-box">
                    <div class="info-label">ì™¸í–‰ì„± ì´ê°</div>
                    <div class="info-value" id="elongation">180Â°</div>
                </div>
                <div class="info-box">
                    <div class="info-label">ì™¸í–‰ì„± ìœ„ì¹˜</div>
                    <div class="info-value" id="marsPosition">ì¶© (Opposition)</div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item"><div class="legend-color color-sun"></div>íƒœì–‘</div>
                <div class="legend-item"><div class="legend-color color-earth"></div>ì§€êµ¬</div>
                <div class="legend-item"><div class="legend-color color-mars"></div>í™”ì„± (ì™¸í–‰ì„±)</div>
            </div>
        </div>

        <div class="explanation">
            <h3>ğŸ“š ì™¸í–‰ì„±ì˜ ìˆœí–‰ê³¼ ì—­í–‰ ì´í•´í•˜ê¸°</h3>
            <ul>
                <li><span class="highlight-prograde">ìˆœí–‰ (Prograde)</span>: ì™¸í–‰ì„±ì´ ë³„ë“¤ ì‚¬ì´ë¥¼ ì„œâ†’ë™ ë°©í–¥ìœ¼ë¡œ ì´ë™í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ëŠ” í˜„ìƒ</li>
                <li><span class="highlight-retrograde">ì—­í–‰ (Retrograde)</span>: ì™¸í–‰ì„±ì´ ë³„ë“¤ ì‚¬ì´ë¥¼ ë™â†’ì„œ ë°©í–¥ìœ¼ë¡œ ì´ë™í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ëŠ” í˜„ìƒ</li>
                <li><span class="highlight-opposition">ì¶© (Opposition)</span>: íƒœì–‘-ì§€êµ¬-ì™¸í–‰ì„±ì´ ì¼ì§ì„  ìƒì— ë†“ì—¬, ì™¸í–‰ì„±ì´ íƒœì–‘ì˜ ì •ë°˜ëŒ€í¸ì— ìœ„ì¹˜í•˜ëŠ” ë•Œ</li>
                <li><strong>ì—­í–‰ì˜ ì›ì¸</strong>: ì§€êµ¬ê°€ ì™¸í–‰ì„±ë³´ë‹¤ ë¹ ë¥´ê²Œ ê³µì „í•˜ë¯€ë¡œ, ì§€êµ¬ê°€ ì™¸í–‰ì„±ì„ ì¶”ì›”í•  ë•Œ ì™¸í–‰ì„±ì´ ë’¤ë¡œ ì›€ì§ì´ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤.</li>
                <li><strong>íšŒí•©ì£¼ê¸°</strong>: í™”ì„±ì˜ ê²½ìš° ì•½ 780ì¼(ì•½ 2ë…„ 2ê°œì›”)ë§ˆë‹¤ ì¶©ì´ ë°˜ë³µë©ë‹ˆë‹¤.</li>
            </ul>
        </div>
    </div>

    <script>
        // ìº”ë²„ìŠ¤ ì„¤ì •
        const helioCanvas = document.getElementById('helioCanvas');
        const geoCanvas = document.getElementById('geoCanvas');
        const skyCanvas = document.getElementById('skyCanvas');
        const helioCtx = helioCanvas.getContext('2d');
        const geoCtx = geoCanvas.getContext('2d');
        const skyCtx = skyCanvas.getContext('2d');

        // ìƒìˆ˜ ì •ì˜
        const SYNODIC_PERIOD = 780; // í™”ì„± íšŒí•©ì£¼ê¸° (ì¼)
        const EARTH_PERIOD = 365.25; // ì§€êµ¬ ê³µì „ì£¼ê¸° (ì¼)
        const MARS_PERIOD = 687; // í™”ì„± ê³µì „ì£¼ê¸° (ì¼)

        // ê¶¤ë„ ë°˜ì§€ë¦„ (í”½ì…€)
        const EARTH_ORBIT_RADIUS = 100;
        const MARS_ORBIT_RADIUS = 152;

        // ì‹œë®¬ë ˆì´ì…˜ ìƒíƒœ
        let isPlaying = false;
        let animationId = null;
        let currentProgress = 0; // 0 ~ 1 (íšŒí•©ì£¼ê¸° ì§„í–‰ë„)
        const MAX_TRAIL_LENGTH = 200;

        // ì‹œì‘ ì‹œ ì§€êµ¬ì™€ í™”ì„±ì˜ ì´ˆê¸° ê°ë„ (ì¶© ìœ„ì¹˜)
        // ì¶©ì¼ ë•Œ: íƒœì–‘-ì§€êµ¬-í™”ì„±ì´ ì¼ì§ì„ , í™”ì„±ì€ ì§€êµ¬ ë°˜ëŒ€í¸
        const INITIAL_EARTH_ANGLE = 0;
        const INITIAL_MARS_ANGLE = Math.PI; // 180Â° ë°˜ëŒ€í¸

        // ê°ì†ë„ (ë¼ë””ì•ˆ/ì¼)
        const EARTH_ANGULAR_VELOCITY = (2 * Math.PI) / EARTH_PERIOD;
        const MARS_ANGULAR_VELOCITY = (2 * Math.PI) / MARS_PERIOD;

        // í˜„ì¬ ê°ë„ ê³„ì‚° í•¨ìˆ˜
        function getAngles(progress) {
            const days = progress * SYNODIC_PERIOD;
            const earthAngle = INITIAL_EARTH_ANGLE + EARTH_ANGULAR_VELOCITY * days;
            const marsAngle = INITIAL_MARS_ANGLE + MARS_ANGULAR_VELOCITY * days;
            return { earthAngle, marsAngle, days };
        }

        // íƒœì–‘ ì¤‘ì‹¬ ë·° ê·¸ë¦¬ê¸°
        function drawHeliocentricView(earthAngle, marsAngle) {
            const ctx = helioCtx;
            const centerX = helioCanvas.width / 2;
            const centerY = helioCanvas.height / 2;

            // ë°°ê²½ í´ë¦¬ì–´
            ctx.clearRect(0, 0, helioCanvas.width, helioCanvas.height);

            // ê¶¤ë„ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = 'rgba(100, 150, 255, 0.3)';
            ctx.lineWidth = 1;

            // ì§€êµ¬ ê¶¤ë„
            ctx.beginPath();
            ctx.arc(centerX, centerY, EARTH_ORBIT_RADIUS, 0, Math.PI * 2);
            ctx.stroke();

            // í™”ì„± ê¶¤ë„
            ctx.beginPath();
            ctx.arc(centerX, centerY, MARS_ORBIT_RADIUS, 0, Math.PI * 2);
            ctx.stroke();

            // íƒœì–‘ ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.arc(centerX, centerY, 15, 0, Math.PI * 2);
            ctx.fillStyle = '#ffdd00';
            ctx.fill();
            ctx.shadowColor = '#ffdd00';
            ctx.shadowBlur = 20;
            ctx.fill();
            ctx.shadowBlur = 0;

            // ì§€êµ¬ ìœ„ì¹˜ ê³„ì‚° ë° ê·¸ë¦¬ê¸°
            const earthX = centerX + EARTH_ORBIT_RADIUS * Math.cos(earthAngle);
            const earthY = centerY - EARTH_ORBIT_RADIUS * Math.sin(earthAngle);

            ctx.beginPath();
            ctx.arc(earthX, earthY, 10, 0, Math.PI * 2);
            ctx.fillStyle = '#4a9eff';
            ctx.fill();

            // í™”ì„± ìœ„ì¹˜ ê³„ì‚° ë° ê·¸ë¦¬ê¸°
            const marsX = centerX + MARS_ORBIT_RADIUS * Math.cos(marsAngle);
            const marsY = centerY - MARS_ORBIT_RADIUS * Math.sin(marsAngle);

            ctx.beginPath();
            ctx.arc(marsX, marsY, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#ff6b4a';
            ctx.fill();

            // íƒœì–‘-ì§€êµ¬-í™”ì„± ì—°ê²°ì„ 
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(earthX, earthY);
            ctx.lineTo(marsX, marsY);
            ctx.stroke();
            ctx.setLineDash([]);

            // ì§€êµ¬ì—ì„œ í™”ì„±ì„ ë°”ë¼ë³´ëŠ” ì‹œì„ 
            ctx.strokeStyle = 'rgba(255, 200, 100, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(earthX, earthY);
            ctx.lineTo(marsX, marsY);
            ctx.stroke();

            // ë ˆì´ë¸”
            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('íƒœì–‘', centerX, centerY + 30);
            ctx.fillText('ì§€êµ¬', earthX, earthY + 20);
            ctx.fillText('í™”ì„±', marsX, marsY + 20);
        }

        // ì§€êµ¬ ì¤‘ì‹¬ ë·° ê·¸ë¦¬ê¸°
        function drawGeocentricView(earthAngle, marsAngle) {
            const ctx = geoCtx;
            const centerX = geoCanvas.width / 2;
            const centerY = geoCanvas.height / 2;
            const maxRadius = Math.min(centerX, centerY) - 30; // ì—¬ë°± í™•ë³´

            ctx.clearRect(0, 0, geoCanvas.width, geoCanvas.height);

            // ì§€êµ¬ ì¤‘ì‹¬ ì¢Œí‘œê³„ì—ì„œì˜ ìœ„ì¹˜ ê³„ì‚°
            // íƒœì–‘ì˜ ìœ„ì¹˜ (ì§€êµ¬ ê¸°ì¤€) - ê³ ì • ê±°ë¦¬ë¡œ í‘œì‹œ
            const sunAngleFromEarth = earthAngle + Math.PI;
            const sunDisplayRadius = maxRadius * 0.6;
            const sunX = centerX + sunDisplayRadius * Math.cos(sunAngleFromEarth);
            const sunY = centerY - sunDisplayRadius * Math.sin(sunAngleFromEarth);

            // í™”ì„±ì˜ ìœ„ì¹˜ (ì§€êµ¬ ê¸°ì¤€)
            const marsRelX = MARS_ORBIT_RADIUS * Math.cos(marsAngle) - EARTH_ORBIT_RADIUS * Math.cos(earthAngle);
            const marsRelY = MARS_ORBIT_RADIUS * Math.sin(marsAngle) - EARTH_ORBIT_RADIUS * Math.sin(earthAngle);
            const marsDistance = Math.sqrt(marsRelX * marsRelX + marsRelY * marsRelY);
            const marsAngleFromEarth = Math.atan2(marsRelY, marsRelX);

            // í™”ì„± ê±°ë¦¬ì— ë”°ë¥¸ ë™ì  ìŠ¤ì¼€ì¼ (í•­ìƒ í™”ë©´ ì•ˆì— ë“¤ì–´ì˜¤ë„ë¡)
            // ìµœëŒ€ ê±°ë¦¬: ì§€êµ¬-í™”ì„± ìµœëŒ€ ê±°ë¦¬ = MARS_ORBIT_RADIUS + EARTH_ORBIT_RADIUS
            const maxMarsDistance = MARS_ORBIT_RADIUS + EARTH_ORBIT_RADIUS;
            const marsDisplayRadius = (marsDistance / maxMarsDistance) * maxRadius * 0.95;
            const marsDisplayX = centerX + marsDisplayRadius * Math.cos(marsAngleFromEarth);
            const marsDisplayY = centerY - marsDisplayRadius * Math.sin(marsAngleFromEarth);

            // ì§€êµ¬ ê·¸ë¦¬ê¸° (ì¤‘ì‹¬)
            ctx.beginPath();
            ctx.arc(centerX, centerY, 12, 0, Math.PI * 2);
            ctx.fillStyle = '#4a9eff';
            ctx.fill();

            // íƒœì–‘ ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.arc(sunX, sunY, 15, 0, Math.PI * 2);
            ctx.fillStyle = '#ffdd00';
            ctx.shadowColor = '#ffdd00';
            ctx.shadowBlur = 15;
            ctx.fill();
            ctx.shadowBlur = 0;

            // í™”ì„± ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.arc(marsDisplayX, marsDisplayY, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#ff6b4a';
            ctx.fill();

            // ì‹œì„  ë°©í–¥ í‘œì‹œ
            ctx.strokeStyle = 'rgba(255, 200, 100, 0.5)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(marsDisplayX, marsDisplayY);
            ctx.stroke();
            ctx.setLineDash([]);

            // ë ˆì´ë¸”
            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ì§€êµ¬', centerX, centerY + 25);
            ctx.fillText('íƒœì–‘', sunX, sunY + 25);
            ctx.fillText('í™”ì„±', marsDisplayX, marsDisplayY + 20);

            return marsAngleFromEarth;
        }

        // 1íšŒí•©ì£¼ê¸° ì „ì²´ ê²½ë¡œë¥¼ ë¯¸ë¦¬ ê³„ì‚°
        let fullPath = [];
        function calculateFullPath() {
            fullPath = [];
            const steps = 100; // 100ê°œ ì§€ì 
            for (let i = 0; i <= steps; i++) {
                const p = i / steps;
                const { earthAngle, marsAngle, days } = getAngles(p);

                const marsRelX = MARS_ORBIT_RADIUS * Math.cos(marsAngle) - EARTH_ORBIT_RADIUS * Math.cos(earthAngle);
                const marsRelY = MARS_ORBIT_RADIUS * Math.sin(marsAngle) - EARTH_ORBIT_RADIUS * Math.sin(earthAngle);
                const angle = Math.atan2(marsRelY, marsRelX);

                fullPath.push({ progress: p, angle: angle, days: days });
            }
        }
        calculateFullPath();

        // ì²œêµ¬ ë·° ê·¸ë¦¬ê¸° - ë³„ìë¦¬ ë°°ê²½ ìœ„ í™”ì„± ì´ë™ ê²½ë¡œ
        function drawSkyView(earthAngle, marsAngle, progress) {
            const ctx = skyCtx;
            const width = skyCanvas.width;
            const height = skyCanvas.height;
            const centerY = height / 2;
            const margin = 60;

            ctx.clearRect(0, 0, width, height);

            // ë°°ê²½ ë³„ ê·¸ë¦¬ê¸° (ê³ ì •ëœ ë°ì€ ë³„ë“¤)
            const starPositions = [
                {x: 0.05, y: 0.3, size: 2}, {x: 0.12, y: 0.7, size: 1.5},
                {x: 0.18, y: 0.4, size: 1}, {x: 0.25, y: 0.6, size: 2.5},
                {x: 0.32, y: 0.25, size: 1.5}, {x: 0.38, y: 0.8, size: 1},
                {x: 0.45, y: 0.35, size: 2}, {x: 0.52, y: 0.65, size: 1.5},
                {x: 0.58, y: 0.2, size: 1}, {x: 0.65, y: 0.75, size: 2},
                {x: 0.72, y: 0.4, size: 1.5}, {x: 0.78, y: 0.55, size: 1},
                {x: 0.85, y: 0.3, size: 2}, {x: 0.92, y: 0.7, size: 1.5},
                {x: 0.15, y: 0.5, size: 1}, {x: 0.35, y: 0.45, size: 1.5},
                {x: 0.55, y: 0.5, size: 1}, {x: 0.75, y: 0.5, size: 1.5},
                {x: 0.95, y: 0.45, size: 1}
            ];

            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            starPositions.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x * width, star.y * height, star.size, 0, Math.PI * 2);
                ctx.fill();
            });

            // í¬ë¯¸í•œ ë°°ê²½ ë³„ë“¤
            ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
            for (let i = 0; i < 80; i++) {
                const x = ((i * 47 + 13) % 100) / 100 * width;
                const y = ((i * 31 + 7) % 100) / 100 * height;
                ctx.beginPath();
                ctx.arc(x, y, 0.8, 0, Math.PI * 2);
                ctx.fill();
            }

            // ì´ˆê¸° ê°ë„ (ì¶© ìœ„ì¹˜ ê¸°ì¤€)
            const initAngle = fullPath[0].angle;

            // í™”ë©´ ì¢Œí‘œ ë³€í™˜ í•¨ìˆ˜
            const angleToX = (angle) => {
                let diff = angle - initAngle;
                while (diff > Math.PI) diff -= 2 * Math.PI;
                while (diff < -Math.PI) diff += 2 * Math.PI;
                // ìˆœí–‰(ê°ë„ ì¦ê°€) = ì™¼ìª½ìœ¼ë¡œ, ì—­í–‰(ê°ë„ ê°ì†Œ) = ì˜¤ë¥¸ìª½ìœ¼ë¡œ
                return width / 2 - diff * (width - margin * 2) / 0.8;
            };

            // ì „ì²´ ê²½ë¡œ ê·¸ë¦¬ê¸° (íšŒìƒ‰ ì ì„ ìœ¼ë¡œ ì˜ˆì • ê²½ë¡œ)
            ctx.setLineDash([3, 3]);
            ctx.strokeStyle = 'rgba(100, 100, 100, 0.4)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            let started = false;
            for (let i = 0; i < fullPath.length; i++) {
                const x = angleToX(fullPath[i].angle);
                if (x > margin && x < width - margin) {
                    if (!started) {
                        ctx.moveTo(x, centerY);
                        started = true;
                    } else {
                        ctx.lineTo(x, centerY);
                    }
                }
            }
            ctx.stroke();
            ctx.setLineDash([]);

            // í˜„ì¬ê¹Œì§€ì˜ ê²½ë¡œ (ìˆœí–‰=ë…¹ìƒ‰, ì—­í–‰=ë¹¨ê°„ìƒ‰)
            const currentIndex = Math.floor(progress * (fullPath.length - 1));

            for (let i = 1; i <= currentIndex; i++) {
                const prev = fullPath[i - 1];
                const curr = fullPath[i];
                const x1 = angleToX(prev.angle);
                const x2 = angleToX(curr.angle);

                // ê°ë„ ë³€í™”ë¡œ ìˆœí–‰/ì—­í–‰ íŒë³„
                let dAngle = curr.angle - prev.angle;
                while (dAngle > Math.PI) dAngle -= 2 * Math.PI;
                while (dAngle < -Math.PI) dAngle += 2 * Math.PI;

                const isRetrograde = dAngle < 0;

                if (x1 > margin && x1 < width - margin && x2 > margin && x2 < width - margin) {
                    ctx.strokeStyle = isRetrograde ? '#f44336' : '#4CAF50';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(x1, centerY);
                    ctx.lineTo(x2, centerY);
                    ctx.stroke();
                }
            }

            // ë‚ ì§œë³„ ìœ„ì¹˜ ì  í‘œì‹œ (30ì¼ ê°„ê²©)
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'center';
            for (let i = 0; i <= currentIndex; i++) {
                const point = fullPath[i];
                const x = angleToX(point.angle);

                if (x > margin && x < width - margin) {
                    // 30ì¼ ê°„ê²©ìœ¼ë¡œ ì ê³¼ ë‚ ì§œ í‘œì‹œ
                    if (Math.round(point.days) % 60 === 0 || i === 0) {
                        ctx.fillStyle = '#ffffff';
                        ctx.beginPath();
                        ctx.arc(x, centerY, 4, 0, Math.PI * 2);
                        ctx.fill();

                        ctx.fillStyle = '#aaaaaa';
                        ctx.fillText(`${Math.round(point.days)}ì¼`, x, centerY + 20);
                    }
                }
            }

            // ì¶© ìœ„ì¹˜ í‘œì‹œ (ì‹œì‘ì )
            const startX = angleToX(initAngle);
            if (startX > margin && startX < width - margin) {
                ctx.fillStyle = '#ffd700';
                ctx.beginPath();
                ctx.arc(startX, centerY, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillText('ì¶©', startX, centerY - 25);
            }

            // í˜„ì¬ í™”ì„± ìœ„ì¹˜
            const marsRelX = MARS_ORBIT_RADIUS * Math.cos(marsAngle) - EARTH_ORBIT_RADIUS * Math.cos(earthAngle);
            const marsRelY = MARS_ORBIT_RADIUS * Math.sin(marsAngle) - EARTH_ORBIT_RADIUS * Math.sin(earthAngle);
            const currentAngle = Math.atan2(marsRelY, marsRelX);
            const currentX = angleToX(currentAngle);

            if (currentX > margin && currentX < width - margin) {
                // í™”ì„± í‘œì‹œ
                ctx.beginPath();
                ctx.arc(currentX, centerY, 12, 0, Math.PI * 2);
                ctx.fillStyle = '#ff6b4a';
                ctx.shadowColor = '#ff6b4a';
                ctx.shadowBlur = 15;
                ctx.fill();
                ctx.shadowBlur = 0;

                // í™”ì„± ë¼ë²¨
                ctx.fillStyle = '#ff6b4a';
                ctx.font = 'bold 12px sans-serif';
                ctx.fillText('â™‚ í™”ì„±', currentX, centerY - 25);
            }

            // ë²”ë¡€ ë° ë°©í–¥ í‘œì‹œ
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillStyle = '#4CAF50';
            ctx.fillText('â” ìˆœí–‰ (ì„œâ†’ë™)', 20, 25);
            ctx.fillStyle = '#f44336';
            ctx.fillText('â” ì—­í–‰ (ë™â†’ì„œ)', 20, 45);

            ctx.textAlign = 'center';
            ctx.fillStyle = '#888';
            ctx.fillText('â† ë™ (E)', margin, height - 15);
            ctx.fillText('ì„œ (W) â†’', width - margin, height - 15);

            // í˜„ì¬ ìš´ë™ ìƒíƒœ í‘œì‹œ
            if (currentIndex > 0) {
                const prev = fullPath[Math.max(0, currentIndex - 1)];
                const curr = fullPath[currentIndex];
                let dAngle = curr.angle - prev.angle;
                while (dAngle > Math.PI) dAngle -= 2 * Math.PI;
                while (dAngle < -Math.PI) dAngle += 2 * Math.PI;

                ctx.font = 'bold 16px sans-serif';
                ctx.textAlign = 'right';
                if (dAngle > 0.0001) {
                    ctx.fillStyle = '#4CAF50';
                    ctx.fillText('â–¶ ìˆœí–‰ ì¤‘', width - 20, 30);
                } else if (dAngle < -0.0001) {
                    ctx.fillStyle = '#f44336';
                    ctx.fillText('â—€ ì—­í–‰ ì¤‘', width - 20, 30);
                } else {
                    ctx.fillStyle = '#ffc107';
                    ctx.fillText('â— ìœ  (ì •ì§€)', width - 20, 30);
                }
            }

            // ì´ê° ê³„ì‚° (ì •ë³´ í‘œì‹œìš©)
            const sunAngle = earthAngle + Math.PI;
            let elongation = currentAngle - sunAngle;
            while (elongation < -Math.PI) elongation += 2 * Math.PI;
            while (elongation > Math.PI) elongation -= 2 * Math.PI;

            return elongation;
        }

        // ìš´ë™ ìƒíƒœ íŒë³„
        function getMotionStatus(progress) {
            const delta = 0.001;
            const { earthAngle: ea1, marsAngle: ma1 } = getAngles(progress);
            const { earthAngle: ea2, marsAngle: ma2 } = getAngles(progress + delta);

            // ì§€êµ¬ì—ì„œ ë³¸ í™”ì„± ë°©í–¥ ê³„ì‚°
            const angle1 = Math.atan2(
                MARS_ORBIT_RADIUS * Math.sin(ma1) - EARTH_ORBIT_RADIUS * Math.sin(ea1),
                MARS_ORBIT_RADIUS * Math.cos(ma1) - EARTH_ORBIT_RADIUS * Math.cos(ea1)
            );
            const angle2 = Math.atan2(
                MARS_ORBIT_RADIUS * Math.sin(ma2) - EARTH_ORBIT_RADIUS * Math.sin(ea2),
                MARS_ORBIT_RADIUS * Math.cos(ma2) - EARTH_ORBIT_RADIUS * Math.cos(ea2)
            );

            let dAngle = angle2 - angle1;
            while (dAngle > Math.PI) dAngle -= 2 * Math.PI;
            while (dAngle < -Math.PI) dAngle += 2 * Math.PI;

            const threshold = 0.00001;
            if (Math.abs(dAngle) < threshold) {
                return { status: 'ìœ ', class: 'stationary', description: 'ìœ  (Stationary)' };
            } else if (dAngle > 0) {
                return { status: 'ìˆœí–‰', class: 'prograde', description: 'ìˆœí–‰ (Prograde)' };
            } else {
                return { status: 'ì—­í–‰', class: 'retrograde', description: 'ì—­í–‰ (Retrograde)' };
            }
        }

        // ìœ„ì¹˜ ì„¤ëª…
        function getPositionDescription(elongationDeg) {
            const absElong = Math.abs(elongationDeg);
            if (absElong > 170) return 'ì¶© (Opposition)';
            if (absElong > 120) return 'ì¶© ê·¼ì²˜';
            if (absElong > 90) return 'ì„œêµ¬/ë™êµ¬ ê·¼ì²˜';
            if (absElong > 45) return 'í•© ì ‘ê·¼ ì¤‘';
            return 'í•© (Conjunction) ê·¼ì²˜';
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI(progress) {
            const { earthAngle, marsAngle, days } = getAngles(progress);

            // ë·° ê·¸ë¦¬ê¸°
            drawHeliocentricView(earthAngle, marsAngle);
            const marsAngleFromEarth = drawGeocentricView(earthAngle, marsAngle);
            const elongation = drawSkyView(earthAngle, marsAngle, progress);

            // ì´ê° ê³„ì‚° (ë„)
            let elongationDeg = (elongation * 180 / Math.PI);

            // ìš´ë™ ìƒíƒœ
            const motion = getMotionStatus(progress);
            document.getElementById('motionStatus').textContent = motion.description;
            document.getElementById('motionStatus').className = `info-value ${motion.class}`;

            // ì§„í–‰ ìƒíƒœ
            document.getElementById('synodicProgress').textContent =
                `${Math.round(days)}ì¼ / ${SYNODIC_PERIOD}ì¼`;

            document.getElementById('elongation').textContent =
                `${Math.abs(elongationDeg).toFixed(1)}Â°`;

            document.getElementById('marsPosition').textContent =
                getPositionDescription(elongationDeg);

            document.getElementById('sliderValue').textContent =
                `${Math.round(progress * 100)}%`;
        }

        // ì• ë‹ˆë©”ì´ì…˜
        function animate() {
            if (!isPlaying) return;

            currentProgress += 0.0005; // ì†ë„ ì¡°ì ˆ
            if (currentProgress >= 1) {
                currentProgress = 0;
            }

            document.getElementById('timeSlider').value = currentProgress * 100;
            updateUI(currentProgress);

            animationId = requestAnimationFrame(animate);
        }

        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        document.getElementById('playBtn').addEventListener('click', () => {
            if (!isPlaying) {
                isPlaying = true;
                animate();
            }
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPlaying = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            isPlaying = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            currentProgress = 0;
            document.getElementById('timeSlider').value = 0;
            updateUI(0);
        });

        document.getElementById('timeSlider').addEventListener('input', (e) => {
            isPlaying = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            currentProgress = e.target.value / 100;
            updateUI(currentProgress);
        });

        // ì´ˆê¸°í™”
        updateUI(0);
    </script>
</body>
</html>
